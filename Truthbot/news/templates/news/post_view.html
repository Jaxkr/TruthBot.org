{% extends "base.html" %}
{% load get_user_vote %}
{% load markdown_parser %}

{% block title %}{{ post.title }}{% endblock %}

{% block maincontent %}
<div class="row">
  <div class="col-md-5">
    <div class="row">
      <div class="col-xs-10">
        <h2><a href="{{ post.link }}">{{ post.title }}</a></h2>
      </div>
      <div class="col-xs-2">
        <button data-post-voted-on="{% get_has_voted post request.user 'post' %}" data-post-id="{{ post.pk }}" class="vote-button btn btn-lg btn-default pull-right">
          <span style="color:{% get_vote_color post request.user 'post' %}" class="voteicon"><i class="fa fa-caret-up" aria-hidden="true"></i></span> <span class="postscore">{{ post.score }}</span>
        </button>
      </div>
    </div>
  </div>
  <div class="col-md-7">
    <h4>Comments</h4>
    {% if request.user.is_authenticated %}
    <form action="" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {{ form.non_field_errors }}
      </div>
      {% endif %}

      <div class="form-group">
        <label for="{{ form.name.id_for_label }}">Add a comment</label>
        {% if form.text.errors %}
        <span class="form-error">{{ form.text.errors.as_text }}</span>
        {% endif %}
        {{ form.text }}
        <span class="help-block">You can use full markdown, including <a target="_blank" href="http://pandoc.org/MANUAL.html#footnotes">citations via footnotes</a>.</span>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form><br>
    {% endif %}
    {% for comment in comments %}
    <div class="panel panel-default">
      <div class="panel-body">
        {{ comment.text|parsemarkdown|safe }}
        <button data-comment-voted-on="{% get_has_voted comment request.user 'comment' %}" data-comment-id="{{ comment.pk }}" class="comment-vote-button btn btn-lg btn-default pull-right">
          <span style="color:{% get_vote_color comment request.user 'comment' %}" class="voteicon"><i class="fa fa-caret-up" aria-hidden="true"></i></span> <span class="postscore">{{ comment.score }}</span>
        </button>
      </div>
      <div class="panel-footer">{{ comment.author.username }}, <a href="{% url "commentperma" post.slug comment.pk %}">{{ comment.timestamp }}</a></div>
    </div>
    {% endfor %}
  </div>
</div>

{% endblock %}
